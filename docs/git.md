# Git 

## Введение

Для любой разработки требуется сохранение кода и контроль версий.
Утилита которая позволяет управлять и отслеживать разными версиями кода называется системой контроля версий.

Рассмотрим программу git, для управления контролем версий. 

## Пакеты git(linux)

Для переноса из других vcs(version control system), могут потребоваться пакеты:
```
git-arch
git-cvs
git-svn
```
Название пакетов в разных дистрибутивах могут отличаться.

Для графического представления истории репозитория могут пригодиться пакеты:
```
git-gui
gitk
gitweb
```
Для отправки патчей посредством email понадобится пакет:

```
git-email
```

## Установка в Windows

Для установки git в Windows. Можно установить:

[https://git-scm.com/download/win](https://git-scm.com/download/win)

Либо Cygwing git:

[https://cygwing.com](https://cygwing.com)


Либо пакет msysGit:

[https://gitforwindows.org/](https://gitforwindows.org/)

## Как хранятся изменения внутри git

Данные репозитория хранятся в директории ```.git```. Git управляет хранилищем объектов и индексом.

Хранилище объектов содержит четыре типа объектов:

- BLOB(Binary Large Object) содержит данные без метаданных
- Деревья. Дерево представляет один уровень, записывает id блобов, имена путей, небольшие метаданные для всех файлов в каталоге
- Коммиты хранят метаданные изменений(имя автора, дату, сообщение коммита) Каждый коммит ссылается на снимок состояния репозитория (объект дерева). Обычные коммиты имеют одного родителя, но возможны и коммиты с несколькими родителями (например, при слиянии веток).  
- Теги человекочитаемое имя назначаемое объекту, обычно коммитам. Например Ver.-1.0

## Индекс

В git это временный и динамический бинарный файл, который описывает структуру каталогов всего репозитория. В частности, индекс получает версию полной структуры проекта в некоторый момент времени.

Git позволяет изменять содержимое индекса четко определенными действиями.

Индекс хранит изменения до коммита.
Изменяется с помощью добавления, удаления, редактирования фпйлов.

## Идентификаторы объектов

Хранилище объектов git организовано в виде ассоциативной системы хранения. Каждому объекту присваивается уникальное имя - идентификатор, на основе алгоритма SHA1. Идентфикатор объекта представляется в виде 40-разрядного 16-ричного числа. Часто его еще называют _хэшкод_.
Хэшкод вычисляется на основе содержимого объекта. Если содержимое объектов идентично они имеют одинаковый хэшкод.

## Отслеживание контента

Благодаря идентификаторам, git может отслеживать контент. Если в репозитории существует два идентичных файла, то для них в хранилище будет создан один BLOB с хэшкодом вычисленным на основе содержимого.

Если один из файлов после изменений будет иметь отличия, соответственно создаться новый BLOB с новым идентификатором объекта.

## Путь vs. Содержание

Git имеет собственную структуру хранилища, которая не основывается на именах и путях файлов. Внутренняя структура git более эффективна для собственных операций над объектами. И она позволяет точно воспроизвести файлы и каталоги проекты проиндексированные хэшем.

## Pack-файлы


Git умно упаковывает файлы. Он находит файлы похожие по содержанию и сохраняет полностью только один файл. Другой файл сохраняется в хранилище в виде дельты, т.е. сохраняется только разница содержимого между первым и вторым файлом.

## Управление индексом

Состояние индекса можно узнать в любой момент с помощью команды:

```git status```

Файлы классифицируются на:

-  отслеживаемые(tracked)
-  игнорируемые(ignored)
-  неотслеживаемые(untracked)

*Отслеживаемые* файлы уже находятся в репозитории

*Игнорируемые* явно объявленные файлы и деректории в .gitignore 

*Неотслеживаемые* файлы которые не добавлены в индекс и отсутствуют в .gitignore


### git add

Добавляет файл(ы) в индекс. Т.е. файл(ы) становится отслеживаемым(и). Также добавляет изменения для уже отслеживаемых файлов.

### git commit

Производится фиксация изменений добавленных в индекс.

Команда ```git commit --all``` автоматически добавляет в индекс изменения отслеживаемых файлов и сразу создает коммит. Не отслеживаемые файлы при этом не меняют свой статус.

Если не указать опцию ```-m``` git запустит редактор указанный в конфигурации для создания коммита.


### git rm

Команда удаляет файлы из индекса и из каталога. Либо удаляет файлы только  из индекса. Не может удалить файлы только с диска(для этого нужно использовать системную команду), т.е. команда работает только с файлами добавленными в репозиторий.

Команда:

```git rm --cached```

Удаляет файл из индекса. Т.е. делает файл неотслеживаемым. 

Но команда ```git rm ``` удалит файл и из индекса и с диска до коммита и после коммита.

Команда:

```git rm -f``` 

Удалит даже отслеживаемый модифицированный файл не добавленный в индекс.

Для восстановления файла удаленного командой ```git rm``` можно использовать механизм восстановления файлов:

```git checkout HEAD -- <file>```

### git mv


Позволяет перемещать и переименовывать файлы находящиеся репозитории или в индексе.

Синтаксис:

```git mv  <file1> <file2>```

## .gitignore

Содержит список файлов и шаблонов которые нужно игнорировать. 


### Формат .gitignore

```# Files``` -- комментарий

```\#file.txt``` -- если название файла начинается с решетки

```file.txt``` -- имена файлов полном виде

```dir/``` -- каталог отмечается следующим образом

```*``` -- заменяет любые символы

Например:

```*.txt``` -- игнорировать все файлы с расширением ```.txt```

```!``` -- задает исключение для общего правила заданного с помощью предшествующего правила.

Например:

```
logs/
!logs/log.txt
```

Игнорирует папку logs и все содержимое, но отслеживает logs/log.txt

```
*.txt
!history.txt
```

Игнорирует все файлы txt, но отслеживает history.txt

Файлы .gitignore можно создавать в любом каталоге репозитория. Каждый файл влияет только на свой каталог и все подкаталоги. Правила .gitignore каскадные, определив общее правило в каталоге высокого уровня, его можно отменять с помощью ```!``` в подкаталогах.

### Приоритет игнорирования

- Шаблоны определенные в командной строке ???
- Шаблоны из файла в верхнем каталоге
- Шаблоны в родительских каталогах, они будут перезаписаны с помощью .gitignore более высокого уровня
- Шаблоны из файла ```.git/info/exclude```
- Шаблоны из файла указанного переменной конфигурации ```core.excludefile```  

*exclude* -- содержит шаблоны как и в .gitignore. Позволяет игнорировать специфичные файлы характерные для операционной системы или ПО, но в .gitignore репозитория отмечать файлы характерные только для его специфики.

